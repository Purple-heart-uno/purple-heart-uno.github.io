<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∏–Ω–æ–º–∞–Ω - —É–≥–∞–¥–∞–π —Ñ–∏–ª—å–º</title>
    <style>
        :root {
            --primary: #e74c3c;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #c0392b;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        header {
            background: var(--dark);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: white;
            border-bottom: 3px solid var(--primary);
        }
        
        .tab:hover {
            background: #d6dbdf;
        }
        
        .content {
            padding: 30px;
            min-height: 400px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .question {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--dark);
            text-align: center;
        }
        
        .answers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .film-list {
            list-style: none;
            margin: 20px 0;
        }
        
        .film-item {
            padding: 15px;
            margin: 10px 0;
            background: var(--light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .film-item:hover {
            background: #d6dbdf;
            transform: translateX(5px);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .attributes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .attribute-item {
            padding: 10px;
            background: var(--light);
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .attribute-item.selected {
            background: var(--success);
            color: white;
        }
        
        .stats {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .tabs { flex-direction: column; }
            .tab { width: 100%; text-align: center; }
            .answers-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¨ –ö–∏–Ω–æ–º–∞–Ω</h1>
            <p>–£–≥–∞–¥–∞–π —Ñ–∏–ª—å–º –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º!</p>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="showSection('game')">–ò–≥—Ä–∞</button>
            <button class="tab" onclick="showSection('admin')">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</button>
            <button class="tab" onclick="showSection('database')">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="tab" onclick="showSection('import-export')">–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>
        
        <div class="content">
            <!-- –ò–≥—Ä–∞ -->
            <div id="game" class="section active">
                <div class="question" id="questionText">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É? –ó–∞–≥–∞–¥–∞–π—Ç–µ —Ñ–∏–ª—å–º, –∞ —è –ø–æ–ø—Ä–æ–±—É—é —É–≥–∞–¥–∞—Ç—å –µ–≥–æ!</div>
                <div class="answers-grid" id="answers" style="display: none;">
                    <button class="btn btn-success" onclick="answerQuestion('–¥–∞')">–î–∞</button>
                    <button class="btn btn-success" onclick="answerQuestion('—Å–∫–æ—Ä–µ–µ –¥–∞')">–°–∫–æ—Ä–µ–µ –¥–∞</button>
                    <button class="btn btn-secondary" onclick="answerQuestion('–Ω–µ –∑–Ω–∞—é')">–ù–µ –∑–Ω–∞—é</button>
                    <button class="btn btn-danger" onclick="answerQuestion('—Å–∫–æ—Ä–µ–µ –Ω–µ—Ç')">–°–∫–æ—Ä–µ–µ –Ω–µ—Ç</button>
                    <button class="btn btn-danger" onclick="answerQuestion('–Ω–µ—Ç')">–ù–µ—Ç</button>
                </div>
                <div id="gameControls">
                    <button class="btn btn-primary" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                    <button class="btn btn-warning" onclick="resetGame()">–°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
                </div>
                <div id="result" style="display: none; margin-top: 20px;">
                    <div id="guessResult"></div>
                    <div id="filmOptions" style="display: none;">
                        <p>–≠—Ç–æ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö —Ñ–∏–ª—å–º–æ–≤?</p>
                        <ul id="filmList" class="film-list"></ul>
                    </div>
                    <div id="guessButtons" style="display: none; margin-top: 20px;">
                        <button class="btn btn-success" onclick="confirmGuess(true)">–î–∞, —É–≥–∞–¥–∞–ª!</button>
                        <button class="btn btn-danger" onclick="confirmGuess(false)">–ù–µ—Ç, –Ω–µ —É–≥–∞–¥–∞–ª</button>
                    </div>
                </div>
            </div>
            
            <!-- –ê–¥–º–∏–Ω–∫–∞ -->
            <div id="admin" class="section">
                <h2>üìù –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∏–ª—å–º</h2>
                
                <div class="form-group">
                    <label for="newFilmTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞:</label>
                    <input type="text" id="newFilmTitle" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞">
                </div>
                
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∞—Ç—Ä–∏–±—É—Ç—ã:</h3>
                <div class="attributes-grid" id="attributesGrid">
                    <!-- –ê—Ç—Ä–∏–±—É—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                
                <div class="form-group">
                    <label for="newAttribute">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç:</label>
                    <input type="text" id="newAttribute" class="form-control" placeholder="–ù–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç">
                    <button class="btn btn-secondary" onclick="addNewAttribute()" style="margin-top: 10px;">–î–æ–±–∞–≤–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç</button>
                </div>
                
                <button class="btn btn-success" onclick="addFilmToDatabase()">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</button>
                
                <div class="stats">
                    <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã:</h4>
                    <p>–§–∏–ª—å–º–æ–≤: <span id="filmsCount">0</span></p>
                    <p>–ê—Ç—Ä–∏–±—É—Ç–æ–≤: <span id="attributesCount">0</span></p>
                </div>
            </div>
            
            <!-- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö -->
            <div id="database" class="section">
                <h2>üé• –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤</h2>
                <input type="text" id="searchFilm" class="form-control" placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–∞..." oninput="searchFilms()">
                <ul id="filmsList" class="film-list">
                    <!-- –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </ul>
            </div>
            
            <!-- –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç -->
            <div id="import-export" class="section">
                <h2>üìÅ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h2>
                
                <div class="export-buttons">
                    <button class="btn btn-primary" onclick="exportDatabase()">–≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã (JSON)</button>
                    <button class="btn btn-success" onclick="downloadDatabase()">–°–∫–∞—á–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</button>
                    <button class="btn btn-warning" onclick="resetDatabase()">–°–±—Ä–æ—Å–∏—Ç—å –±–∞–∑—É</button>
                </div>
                
                <div class="form-group">
                    <label for="importFile">–ò–º–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:</label>
                    <input type="file" id="importFile" class="form-control" accept=".json">
                    <button class="btn btn-secondary" onclick="importDatabase()" style="margin-top: 10px;">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                
                <div class="stats">
                    <h4>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è GitHub Pages:</h4>
                    <ol>
                        <li>–°–∫–∞—á–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–∫–æ–π –≤—ã—à–µ</li>
                        <li>–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub</li>
                        <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ index.html –∏ films_database.json</li>
                        <li>–í–∫–ª—é—á–∏—Ç–µ GitHub Pages –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</li>
                        <li>–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ!</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        class FilmAkinator {
            constructor() {
                this.database = [];
                this.attributes = new Set();
                this.current_answers = {};
                this.possible_answers = {
                    "–¥–∞": 1, "—Å–∫–æ—Ä–µ–µ –¥–∞": 0.7, "–Ω–µ –∑–Ω–∞—é": 0, 
                    "—Å–∫–æ—Ä–µ–µ –Ω–µ—Ç": -0.7, "–Ω–µ—Ç": -1
                };
                this.loadDatabase();
            }
            
            loadDatabase() {
                try {
                    const saved = localStorage.getItem('filmDatabase');
                    if (saved) {
                        this.database = JSON.parse(saved);
                        this.updateAttributes();
                        console.log('–ë–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ localStorage:', this.database.length, '—Ñ–∏–ª—å–º–æ–≤');
                    } else {
                        this.loadDefaultDatabase();
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã:', e);
                    this.loadDefaultDatabase();
                }
            }
            
            loadDefaultDatabase() {
                this.database = [
                    {
                        "title": "–ö—Ä–µ—Å—Ç–Ω—ã–π –æ—Ç–µ—Ü",
                        "attributes": {
                            "—Å—Ç—Ä–∞–Ω–∞_–°–®–ê": true, "–≥–æ–¥_1972": true, "–∂–∞–Ω—Ä_–∫—Ä–∏–º–∏–Ω–∞–ª": true,
                            "—Ä–µ–∂–∏—Å—Å–µ—Ä_–ö–æ–ø–ø–æ–ª–∞": true, "–∞–∫—Ç–µ—Ä_–ë—Ä–∞–Ω–¥–æ": true,
                            "–∫–æ–º–ø–∞–Ω–∏—è_Paramount": true, "–æ—Å–Ω–æ–≤–∞–Ω_–Ω–∞_–∫–Ω–∏–≥–µ": true,
                            "–ø—Ä–µ–º–∏—è_–û—Å–∫–∞—Ä": true, "—Å–∏–∫–≤–µ–ª—ã": true, "–º–∞—Ñ–∏ia": true
                        }
                    },
                    {
                        "title": "–¢–∏—Ç–∞–Ω–∏–∫",
                        "attributes": {
                            "—Å—Ç—Ä–∞–Ω–∞_–°–®–ê": true, "–≥–æ–¥_1997": true, "–∂–∞–Ω—Ä_–º–µ–ª–æ–¥—Ä–∞–º–∞": true,
                            "—Ä–µ–∂–∏—Å—Å–µ—Ä_–ö—ç–º–µ—Ä–æ–Ω": true, "–∞–∫—Ç–µ—Ä_–î–∏–ö–∞–ø—Ä–∏–æ": true,
                            "–∫–æ–º–ø–∞–Ω–∏—è_Fox": true, "–æ—Å–Ω–æ–≤–∞–Ω_–Ω–∞_—Ä–µ–∞–ª—å–Ω—ã—Ö_—Å–æ–±—ã—Ç–∏—è—Ö": true,
                            "–ø—Ä–µ–º–∏—è_–û—Å–∫–∞—Ä": true, "–∫–æ—Ä–∞–±–ª—å": true, "–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞": true
                        }
                    }
                ];
                this.saveDatabase();
                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –±–∞–∑–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
            }
            
            updateAttributes() {
                this.attributes.clear();
                this.database.forEach(film => {
                    Object.keys(film.attributes).forEach(attr => this.attributes.add(attr));
                });
            }
            
            saveDatabase() {
                localStorage.setItem('filmDatabase', JSON.stringify(this.database));
                this.updateAttributes();
                updateStats();
            }
            
            addFilm(title, selectedAttributes) {
                const attributes = {};
                selectedAttributes.forEach(attr => {
                    attributes[attr] = true;
                });
                
                this.database.push({
                    title: title,
                    attributes: attributes
                });
                
                this.saveDatabase();
                return true;
            }
            
            deleteFilm(index) {
                if (index >= 0 && index < this.database.length) {
                    this.database.splice(index, 1);
                    this.saveDatabase();
                    return true;
                }
                return false;
            }
            
            get_all_attributes() {
                return Array.from(this.attributes);
            }
            
            attribute_to_numeric(film, attribute) {
                const value = film.attributes[attribute];
                return value ? 1 : -1;
            }
            
            calculate_information_gain(attribute) {
                if (!this.database.length) return 0;
                
                const values = this.database.map(film => 
                    this.attribute_to_numeric(film, attribute)
                );
                
                if (new Set(values).size === 1) return 0;
                
                const counts = {};
                values.forEach(v => counts[v] = (counts[v] || 0) + 1);
                
                let entropy = 0;
                const total = values.length;
                
                for (const count of Object.values(counts)) {
                    const p = count / total;
                    if (p > 0) {
                        entropy -= p * Math.log2(p);
                    }
                }
                
                return entropy;
            }
            
            choose_best_question() {
                if (!this.database.length) {
                    console.log('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞');
                    return null;
                }
                
                const attributes = this.get_all_attributes();
                let best_attribute = null;
                let best_gain = -1;
                
                for (const attribute of attributes) {
                    if (!this.current_answers.hasOwnProperty(attribute)) {
                        const gain = this.calculate_information_gain(attribute);
                        if (gain > best_gain) {
                            best_gain = gain;
                            best_attribute = attribute;
                        }
                    }
                }
                
                console.log('–í—ã–±—Ä–∞–Ω –≤–æ–ø—Ä–æ—Å:', best_attribute, '—Å gain:', best_gain);
                return best_attribute;
            }
            
            filter_films() {
                return this.database.map(film => {
                    let match_score = 0;
                    let total_weight = 0;
                    
                    for (const [attribute, user_answer] of Object.entries(this.current_answers)) {
                        if (film.attributes.hasOwnProperty(attribute)) {
                            const film_value = this.attribute_to_numeric(film, attribute);
                            const similarity = 1 - Math.abs(film_value - user_answer) / 2;
                            match_score += similarity;
                            total_weight += 1;
                        }
                    }
                    
                    return {
                        ...film,
                        match_score: total_weight > 0 ? match_score / total_weight : 0
                    };
                }).sort((a, b) => b.match_score - a.match_score);
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let akinator = new FilmAkinator();
        let currentQuestion = null;
        let selectedAttributes = new Set();

        // –§—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`.tab[onclick="showSection('${sectionId}')"]`).classList.add('active');
            
            if (sectionId === 'database') {
                displayFilmsList();
            } else if (sectionId === 'admin') {
                renderAttributesGrid();
                updateStats();
            }
        }

        function startGame() {
            akinator.current_answers = {};
            document.getElementById('gameControls').style.display = 'none';
            document.getElementById('answers').style.display = 'grid';
            document.getElementById('result').style.display = 'none';
            showQuestion();
        }

        function showQuestion() {
            currentQuestion = akinator.choose_best_question();
            
            if (!currentQuestion) {
                endGame();
                return;
            }
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∞—Ç—Ä–∏–±—É—Ç –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–æ–ø—Ä–æ—Å
            let questionText = currentQuestion;
            if (questionText.includes('_')) {
                const parts = questionText.split('_');
                const mainPart = parts[0];
                const valuePart = parts.slice(1).join(' ');
                
                switch(mainPart) {
                    case '—Å—Ç—Ä–∞–Ω–∞':
                        questionText = `–§–∏–ª—å–º —Å–Ω—è—Ç –≤ ${valuePart}?`;
                        break;
                    case '–≥–æ–¥':
                        questionText = `–§–∏–ª—å–º –≤—ã—à–µ–ª –≤ ${valuePart} –≥–æ–¥—É?`;
                        break;
                    case '–∂–∞–Ω—Ä':
                        questionText = `–≠—Ç–æ —Ñ–∏–ª—å–º –≤ –∂–∞–Ω—Ä–µ ${valuePart}?`;
                        break;
                    case '—Ä–µ–∂–∏—Å—Å–µ—Ä':
                        questionText = `–§–∏–ª—å–º —Å–Ω—è–ª ${valuePart}?`;
                        break;
                    case '–∞–∫—Ç–µ—Ä':
                        questionText = `–í –≥–ª–∞–≤–Ω–æ–π —Ä–æ–ª–∏ ${valuePart}?`;
                        break;
                    case '–∫–æ–º–ø–∞–Ω–∏—è':
                        questionText = `–§–∏–ª—å–º –≤—ã–ø—É—Å—Ç–∏–ª–∞ –∫–æ–º–ø–∞–Ω–∏—è ${valuePart}?`;
                        break;
                    default:
                        questionText = `–§–∏–ª—å–º —Å–≤—è–∑–∞–Ω —Å "${questionText.replace(/_/g, ' ')}"?`;
                }
            } else {
                questionText = `–§–∏–ª—å–º —Å–≤—è–∑–∞–Ω —Å "${questionText}"?`;
            }
            
            document.getElementById('questionText').textContent = questionText;
            console.log('–ó–∞–¥–∞–Ω –≤–æ–ø—Ä–æ—Å:', currentQuestion);
        }

        function answerQuestion(answer) {
            if (!currentQuestion) return;
            
            akinator.current_answers[currentQuestion] = akinator.possible_answers[answer];
            console.log('–û—Ç–≤–µ—Ç:', answer, '–Ω–∞ –≤–æ–ø—Ä–æ—Å:', currentQuestion);
            
            const candidates = akinator.filter_films();
            const bestCandidate = candidates[0];
            
            if (bestCandidate && bestCandidate.match_score > 0.7) {
                showGuess(bestCandidate.title);
            } else if (candidates.length <= 3) {
                showFilmOptions(candidates);
            } else {
                showQuestion();
            }
        }

        function showGuess(filmTitle) {
            document.getElementById('game').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('guessResult').innerHTML = 
                `<h3>üéâ –Ø –¥—É–º–∞—é, —ç—Ç–æ: ${filmTitle}</h3>`;
            document.getElementById('guessButtons').classList.remove('hidden');
            document.getElementById('filmOptions').classList.add('hidden');
        }

        function showFilmOptions(candidates) {
            document.getElementById('game').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('guessResult').innerHTML = 
                '<h3>üìã –í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:</h3>';
            document.getElementById('guessButtons').classList.add('hidden');
            
            const filmList = document.getElementById('filmList');
            filmList.innerHTML = '';
            
            candidates.slice(0, 5).forEach(film => {
                const li = document.createElement('li');
                li.className = 'film-item';
                li.textContent = film.title;
                li.onclick = () => confirmFilmGuess(film.title);
                filmList.appendChild(li);
            });
            
            document.getElementById('filmOptions').classList.remove('hidden');
        }

        function confirmFilmGuess(filmTitle) {
            document.getElementById('guessResult').innerHTML = 
                `<h3>üéâ –û—Ç–ª–∏—á–Ω–æ! –≠—Ç–æ ${filmTitle}</h3>`;
            document.getElementById('filmOptions').classList.add('hidden');
            
            setTimeout(() => {
                if (confirm('–•–æ—Ç–∏—Ç–µ —Å—ã–≥—Ä–∞—Ç—å –µ—â–µ —Ä–∞–∑?')) {
                    startGame();
                }
            }, 1000);
        }

        function confirmGuess(isCorrect) {
            if (isCorrect) {
                document.getElementById('guessResult').innerHTML = 
                    '<h3>üéâ –£—Ä–∞! –Ø —É–≥–∞–¥–∞–ª!</h3>';
                setTimeout(() => {
                    if (confirm('–•–æ—Ç–∏—Ç–µ —Å—ã–≥—Ä–∞—Ç—å –µ—â–µ —Ä–∞–∑?')) {
                        startGame();
                    }
                }, 1000);
            } else {
                document.getElementById('result').classList.add('hidden');
                document.getElementById('newFilm').classList.remove('hidden');
            }
        }

        function endGame() {
            document.getElementById('questionText').textContent = '–ù–µ –º–æ–≥—É —É–≥–∞–¥–∞—Ç—å —Ñ–∏–ª—å–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Ñ–∏–ª—å–º–æ–≤ –≤ –±–∞–∑—É!';
            document.getElementById('answers').style.display = 'none';
            document.getElementById('gameControls').style.display = 'block';
        }

        function renderAttributesGrid() {
            const grid = document.getElementById('attributesGrid');
            grid.innerHTML = '';
            
            const allAttributes = akinator.get_all_attributes();
            console.log('–í—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã:', allAttributes);
            
            allAttributes.forEach(attr => {
                const div = document.createElement('div');
                div.className = 'attribute-item';
                div.textContent = attr.replace(/_/g, ' ');
                div.onclick = () => toggleAttribute(attr, div);
                
                if (selectedAttributes.has(attr)) {
                    div.classList.add('selected');
                }
                
                grid.appendChild(div);
            });
        }

        function toggleAttribute(attr, element) {
            if (selectedAttributes.has(attr)) {
                selectedAttributes.delete(attr);
                element.classList.remove('selected');
            } else {
                selectedAttributes.add(attr);
                element.classList.add('selected');
            }
        }

        function addNewAttribute() {
            const newAttr = document.getElementById('newAttribute').value.trim();
            if (newAttr) {
                const formattedAttr = newAttr.replace(/\s+/g, '_');
                selectedAttributes.add(formattedAttr);
                renderAttributesGrid();
                document.getElementById('newAttribute').value = '';
            }
        }

        function addFilmToDatabase() {
            const title = document.getElementById('newFilmTitle').value.trim();
            if (!title) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞!');
                return;
            }
            
            if (selectedAttributes.size === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∞—Ç—Ä–∏–±—É—Ç!');
                return;
            }
            
            if (akinator.addFilm(title, Array.from(selectedAttributes))) {
                alert(`–§–∏–ª—å–º "${title}" –¥–æ–±–∞–≤–ª–µ–Ω!`);
                document.getElementById('newFilmTitle').value = '';
                selectedAttributes.clear();
                renderAttributesGrid();
                updateStats();
            }
        }

        function updateStats() {
            document.getElementById('filmsCount').textContent = akinator.database.length;
            document.getElementById('attributesCount').textContent = akinator.attributes.size;
        }

        function displayFilmsList() {
            const list = document.getElementById('filmsList');
            list.innerHTML = '';
            
            akinator.database.forEach((film, index) => {
                const li = document.createElement('li');
                li.className = 'film-item';
                
                const filmInfo = document.createElement('div');
                filmInfo.innerHTML = `
                    <strong>${film.title}</strong>
                    <br><small>–ê—Ç—Ä–∏–±—É—Ç–æ–≤: ${Object.keys(film.attributes).length}</small>
                `;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                deleteBtn.style.marginLeft = '10px';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    if (confirm(`–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å–º "${film.title}"?`)) {
                        akinator.deleteFilm(index);
                        displayFilmsList();
                    }
                };
                
                li.appendChild(filmInfo);
                li.appendChild(deleteBtn);
                list.appendChild(li);
            });
        }

        function searchFilms() {
            const searchTerm = document.getElementById('searchFilm').value.toLowerCase();
            const items = document.querySelectorAll('.film-item');
            
            items.forEach(item => {
                const filmName = item.querySelector('strong').textContent.toLowerCase();
                if (filmName.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function exportDatabase() {
            const dataStr = JSON.stringify(akinator.database, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'films_database.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function downloadDatabase() {
            const data = {
                database: akinator.database,
                lastUpdated: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'films_database_full.json';
            a.click();
            
            URL.revokeObjectURL(url);
        }

        function importDatabase() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (Array.isArray(data)) {
                        akinator.database = data;
                    } else if (data.database) {
                        akinator.database = data.database;
                    } else {
                        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                    }
                    
                    akinator.saveDatabase();
                    alert('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞!');
                    fileInput.value = '';
                    updateStats();
                    displayFilmsList();
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function resetDatabase() {
            if (confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é? –í—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
                akinator.loadDefaultDatabase();
                updateStats();
                displayFilmsList();
                alert('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é!');
            }
        }

        function resetGame() {
            akinator.current_answers = {};
            document.getElementById('gameControls').style.display = 'block';
            document.getElementById('answers').style.display = 'none';
            document.getElementById('result').style.display = 'none';
            document.getElementById('questionText').textContent = '–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É? –ó–∞–≥–∞–¥–∞–π—Ç–µ —Ñ–∏–ª—å–º, –∞ —è –ø–æ–ø—Ä–æ–±—É—é —É–≥–∞–¥–∞—Ç—å –µ–≥–æ!';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            renderAttributesGrid();
            displayFilmsList();
            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        });

        // –î–ª—è GitHub Pages - –∑–∞–≥—Ä—É–∑–∫–∞ –≤–Ω–µ—à–Ω–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function loadExternalDatabase() {
            try {
                const response = await fetch('films_database.json');
                if (response.ok) {
                    const data = await response.json();
                    akinator.database = data;
                    akinator.saveDatabase();
                    updateStats();
                    displayFilmsList();
                    console.log('–í–Ω–µ—à–Ω—è—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                }
            } catch (error) {
                console.log('–í–Ω–µ—à–Ω—è—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é');
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–Ω–µ—à–Ω—é—é –±–∞–∑—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        loadExternalDatabase();
    </script>
</body>
  </html>
