<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∏–Ω–æ–º–∞–Ω - —É–≥–∞–¥–∞–π —Ñ–∏–ª—å–º</title>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        :root {
            --primary: #e74c3c;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #c0392b;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        header {
            background: var(--dark);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: white;
            border-bottom: 3px solid var(--primary);
        }
        
        .tab:hover {
            background: #d6dbdf;
        }
        
        .content {
            padding: 30px;
            min-height: 400px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .question {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--dark);
            text-align: center;
        }
        
        .answers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .film-list {
            list-style: none;
            margin: 20px 0;
        }
        
        .film-item {
            padding: 15px;
            margin: 10px 0;
            background: var(--light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .film-item:hover {
            background: #d6dbdf;
            transform: translateX(5px);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .attributes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .attribute-item {
            padding: 10px;
            background: var(--light);
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .attribute-item.selected {
            background: var(--success);
            color: white;
        }
        
        .stats {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .progress {
            height: 10px;
            background: #ddd;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--success);
            transition: width 0.3s;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--secondary);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .tabs { flex-direction: column; }
            .tab { width: 100%; text-align: center; }
            .answers-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¨ –ö–∏–Ω–æ–º–∞–Ω</h1>
            <p>–£–≥–∞–¥–∞–π —Ñ–∏–ª—å–º –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º!</p>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="showSection('game')">–ò–≥—Ä–∞</button>
            <button class="tab" onclick="showSection('admin')">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</button>
            <button class="tab" onclick="showSection('database')">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="tab" onclick="showSection('import-export')">–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>
        
        <div class="content">
            <!-- –ò–≥—Ä–∞ -->
            <div id="game" class="section active">
                <div class="question" id="questionText">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É? –ó–∞–≥–∞–¥–∞–π—Ç–µ —Ñ–∏–ª—å–º, –∞ —è –ø–æ–ø—Ä–æ–±—É—é —É–≥–∞–¥–∞—Ç—å –µ–≥–æ!</div>
                <div class="progress">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="answers-grid" id="answers" style="display: none;">
                    <button class="btn btn-success" onclick="answerQuestion('–¥–∞')">–î–∞</button>
                    <button class="btn btn-success" onclick="answerQuestion('—Å–∫–æ—Ä–µ–µ –¥–∞')">–°–∫–æ—Ä–µ–µ –¥–∞</button>
                    <button class="btn btn-secondary" onclick="answerQuestion('–Ω–µ –∑–Ω–∞—é')">–ù–µ –∑–Ω–∞—é</button>
                    <button class="btn btn-danger" onclick="answerQuestion('—Å–∫–æ—Ä–µ–µ –Ω–µ—Ç')">–°–∫–æ—Ä–µ–µ –Ω–µ—Ç</button>
                    <button class="btn btn-danger" onclick="answerQuestion('–Ω–µ—Ç')">–ù–µ—Ç</button>
                </div>
                <div id="gameControls">
                    <button class="btn btn-primary" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                    <button class="btn btn-warning" onclick="resetGame()">–°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
                </div>
                <div id="result" style="display: none; margin-top: 20px;">
                    <div id="guessResult"></div>
                    <div id="filmOptions" style="display: none;">
                        <p>–≠—Ç–æ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö —Ñ–∏–ª—å–º–æ–≤?</p>
                        <ul id="filmList" class="film-list"></ul>
                        <button class="btn btn-secondary" onclick="continueGame()">–ù–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É–≥–∞–¥—ã–≤–∞—Ç—å</button>
                    </div>
                    <div id="guessButtons" style="display: none; margin-top: 20px;">
                        <button class="btn btn-success" onclick="confirmGuess(true)">–î–∞, —É–≥–∞–¥–∞–ª!</button>
                        <button class="btn btn-danger" onclick="confirmGuess(false)">–ù–µ—Ç, –Ω–µ —É–≥–∞–¥–∞–ª</button>
                    </div>
                </div>
            </div>
            
            <!-- –ê–¥–º–∏–Ω–∫–∞ -->
            <div id="admin" class="section">
                <h2>üìù –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∏–ª—å–º</h2>
                
                <div class="form-group">
                    <label for="newFilmTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞:</label>
                    <input type="text" id="newFilmTitle" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞">
                </div>
                
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∞—Ç—Ä–∏–±—É—Ç—ã:</h3>
                <div id="loadingAttributes" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤...</div>
                <div class="attributes-grid" id="attributesGrid" style="display: none;">
                    <!-- –ê—Ç—Ä–∏–±—É—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                
                <div class="form-group">
                    <label for="newAttribute">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newAttribute" class="form-control" placeholder="–ù–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç">
                        <button class="btn btn-secondary" onclick="addNewAttribute()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="addFilmToDatabase()">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</button>
                <div id="addFilmStatus" style="margin-top: 10px;"></div>
                
                <div class="stats">
                    <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã:</h4>
                    <p>–§–∏–ª—å–º–æ–≤: <span id="filmsCount">0</span></p>
                    <p>–ê—Ç—Ä–∏–±—É—Ç–æ–≤: <span id="attributesCount">0</span></p>
                </div>
            </div>
            
            <!-- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö -->
            <div id="database" class="section">
                <h2>üé• –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤</h2>
                <input type="text" id="searchFilm" class="form-control" placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–∞..." oninput="searchFilms()">
                <div id="loadingFilms" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å–º–æ–≤...</div>
                <ul id="filmsList" class="film-list" style="display: none;">
                    <!-- –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </ul>
            </div>
            
            <!-- –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç -->
            <div id="import-export" class="section">
                <h2>üìÅ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h2>
                
                <div class="export-buttons">
                    <button class="btn btn-primary" onclick="exportDatabase()">–≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã (JSON)</button>
                    <button class="btn btn-success" onclick="downloadDatabase()">–°–∫–∞—á–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</button>
                    <button class="btn btn-warning" onclick="resetDatabase()">–°–±—Ä–æ—Å–∏—Ç—å –±–∞–∑—É</button>
                </div>
                
                <div class="form-group">
                    <label for="importFile">–ò–º–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:</label>
                    <input type="file" id="importFile" class="form-control" accept=".json">
                    <button class="btn btn-secondary" onclick="importDatabase()" style="margin-top: 10px;">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                
                <div class="stats">
                    <h4>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è GitHub Pages:</h4>
                    <ol>
                        <li>–°–∫–∞—á–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–∫–æ–π –≤—ã—à–µ</li>
                        <li>–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub</li>
                        <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ index.html –∏ films_database.json</li>
                        <li>–í–∫–ª—é—á–∏—Ç–µ GitHub Pages –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</li>
                        <li>–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ!</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        class FilmAkinator {
            constructor() {
                this.database = [];
                this.attributes = new Set();
                this.current_answers = {};
                this.possible_answers = {
                    "–¥–∞": 1, "—Å–∫–æ—Ä–µ–µ –¥–∞": 0.7, "–Ω–µ –∑–Ω–∞—é": 0, 
                    "—Å–∫–æ—Ä–µ–µ –Ω–µ—Ç": -0.7, "–Ω–µ—Ç": -1
                };
                this.isLoading = true;
                this.init();
            }
            
            async init() {
                await this.loadDatabase();
                this.isLoading = false;
            }
            
            async loadDatabase() {
                try {
                    // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–Ω–µ—à–Ω—é—é –±–∞–∑—É —Å–Ω–∞—á–∞–ª–∞
                    try {
                        const response = await fetch('films_database.json');
                        if (response.ok) {
                            const data = await response.json();
                            if (Array.isArray(data)) {
                                this.database = data;
                                console.log('–í–Ω–µ—à–Ω—è—è –±–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', this.database.length, '—Ñ–∏–ª—å–º–æ–≤');
                                this.saveToLocalStorage();
                                this.updateAttributes();
                                return;
                            }
                        }
                    } catch (e) {
                        console.log('–í–Ω–µ—à–Ω—è—è –±–∞–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø—Ä–æ–±—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é');
                    }
                    
                    // –ï—Å–ª–∏ –≤–Ω–µ—à–Ω–µ–π –Ω–µ—Ç, –ø—Ä–æ–±—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é
                    const saved = localStorage.getItem('filmDatabase');
                    if (saved) {
                        this.database = JSON.parse(saved);
                        console.log('–õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', this.database.length, '—Ñ–∏–ª—å–º–æ–≤');
                    } else {
                        await this.loadDefaultDatabase();
                    }
                    
                    this.updateAttributes();
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã:', e);
                    await this.loadDefaultDatabase();
                }
            }
            
            async loadDefaultDatabase() {
                this.database = [
                    {
                        "title": "–ö—Ä–µ—Å—Ç–Ω—ã–π –æ—Ç–µ—Ü",
                        "attributes": {
                            "—Å—Ç—Ä–∞–Ω–∞_–°–®–ê": true, "–≥–æ–¥_1972": true, "–∂–∞–Ω—Ä_–∫—Ä–∏–º–∏–Ω–∞–ª": true,
                            "—Ä–µ–∂–∏—Å—Å–µ—Ä_–ö–æ–ø–ø–æ–ª–∞": true, "–∞–∫—Ç–µ—Ä_–ë—Ä–∞–Ω–¥–æ": true,
                            "–∫–æ–º–ø–∞–Ω–∏—è_Paramount": true, "–æ—Å–Ω–æ–≤–∞–Ω_–Ω–∞_–∫–Ω–∏–≥–µ": true,
                            "–ø—Ä–µ–º–∏—è_–û—Å–∫–∞—Ä": true, "—Å–∏–∫–≤–µ–ª—ã": true, "–º–∞—Ñ–∏—è": true
                        }
                    },
                    {
                        "title": "–¢–∏—Ç–∞–Ω–∏–∫",
                        "attributes": {
                            "—Å—Ç—Ä–∞–Ω–∞_–°–®–ê": true, "–≥–æ–¥_1997": true, "–∂–∞–Ω—Ä_–º–µ–ª–æ–¥—Ä–∞–º–∞": true,
                            "—Ä–µ–∂–∏—Å—Å–µ—Ä_–ö—ç–º–µ—Ä–æ–Ω": true, "–∞–∫—Ç–µ—Ä_–î–∏–ö–∞–ø—Ä–∏–æ": true,
                            "–∫–æ–º–ø–∞–Ω–∏—è_Fox": true, "–æ—Å–Ω–æ–≤–∞–Ω_–Ω–∞_—Ä–µ–∞–ª—å–Ω—ã—Ö_—Å–æ–±—ã—Ç–∏—è—Ö": true,
                            "–ø—Ä–µ–º–∏—è_–û—Å–∫–∞—Ä": true, "–∫–æ—Ä–∞–±–ª—å": true, "–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞": true
                        }
                    }
                ];
                this.saveToLocalStorage();
                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –±–∞–∑–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
            }
            
            updateAttributes() {
                this.attributes.clear();
                this.database.forEach(film => {
                    Object.keys(film.attributes).forEach(attr => this.attributes.add(attr));
                });
            }
            
            saveToLocalStorage() {
                try {
                    localStorage.setItem('filmDatabase', JSON.stringify(this.database));
                } catch (e) {
                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage:', e);
                }
            }
            
            async addFilm(title, selectedAttributes) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        try {
                            const attributes = {};
                            selectedAttributes.forEach(attr => {
                                attributes[attr] = true;
                            });
                            
                            const newFilm = {
                                title: title.trim(),
                                attributes: attributes
                            };
                            
                            this.database.push(newFilm);
                            this.updateAttributes();
                            this.saveToLocalStorage();
                            
                            console.log('–§–∏–ª—å–º –¥–æ–±–∞–≤–ª–µ–Ω:', newFilm);
                            resolve(true);
                        } catch (e) {
                            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å–º–∞:', e);
                            resolve(false);
                        }
                    }, 100);
                });
            }
            
            deleteFilm(index) {
                if (index >= 0 && index < this.database.length) {
                    this.database.splice(index, 1);
                    this.updateAttributes();
                    this.saveToLocalStorage();
                    return true;
                }
                return false;
            }
            
            get_all_attributes() {
                return Array.from(this.attributes).sort();
            }
            
            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let akinator = new FilmAkinator();
        let currentQuestion = null;
        let selectedAttributes = new Set();
        let questionsCount = 0;

        // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã
        async function waitForDatabase() {
            while (akinator.isLoading) {
                await new Promise(resolve => setTimeout(resolve, 100));
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        async function showSection(sectionId) {
            await waitForDatabase();
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`.tab[onclick="showSection('${sectionId}')"]`).classList.add('active');
            
            if (sectionId === 'database') {
                displayFilmsList();
            } else if (sectionId === 'admin') {
                renderAttributesGrid();
                updateStats();
            }
        }

        function startGame() {
            akinator.current_answers = {};
            questionsCount = 0;
            document.getElementById('gameControls').style.display = 'none';
            document.getElementById('answers').style.display = 'grid';
            document.getElementById('result').style.display = 'none';
            document.getElementById('progressBar').style.width = '0%';
            showQuestion();
        }

        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...

        async function renderAttributesGrid() {
            await waitForDatabase();
            
            const grid = document.getElementById('attributesGrid');
            const loading = document.getElementById('loadingAttributes');
            
            if (akinator.attributes.size === 0) {
                loading.innerHTML = '–ù–µ—Ç –∞—Ç—Ä–∏–±—É—Ç–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ñ–∏–ª—å–º!';
                return;
            }
            
            loading.style.display = 'none';
            grid.style.display = 'grid';
            grid.innerHTML = '';
            
            const allAttributes = akinator.get_all_attributes();
            
            allAttributes.forEach(attr => {
                const div = document.createElement('div');
                div.className = 'attribute-item';
                div.textContent = attr.replace(/_/g, ' ');
                div.onclick = () => toggleAttribute(attr, div);
                
                if (selectedAttributes.has(attr)) {
                    div.classList.add('selected');
                }
                
                grid.appendChild(div);
            });
        }

        function toggleAttribute(attr, element) {
            if (selectedAttributes.has(attr)) {
                selectedAttributes.delete(attr);
                element.classList.remove('selected');
            } else {
                selectedAttributes.add(attr);
                element.classList.add('selected');
            }
        }

        function addNewAttribute() {
            const newAttrInput = document.getElementById('newAttribute');
            const newAttr = newAttrInput.value.trim();
            
            if (!newAttr) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞!');
                return;
            }
            
            const formattedAttr = newAttr.replace(/\s+/g, '_');
            
            if (!selectedAttributes.has(formattedAttr)) {
                selectedAttributes.add(formattedAttr);
                renderAttributesGrid();
                newAttrInput.value = '';
            }
        }

        async function addFilmToDatabase() {
            await waitForDatabase();
            
            const titleInput = document.getElementById('newFilmTitle');
            const title = titleInput.value.trim();
            const statusDiv = document.getElementById('addFilmStatus');
            
            if (!title) {
                statusDiv.innerHTML = '<span style="color: var(--danger);">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞!</span>';
                return;
            }
            
            if (selectedAttributes.size === 0) {
                statusDiv.innerHTML = '<span style="color: var(--danger);">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∞—Ç—Ä–∏–±—É—Ç!</span>';
                return;
            }
            
            statusDiv.innerHTML = '<span style="color: var(--secondary);">–î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å–º...</span>';
            
            try {
                const success = await akinator.addFilm(title, Array.from(selectedAttributes));
                
                if (success) {
                    statusDiv.innerHTML = `<span style="color: var(--success);">–§–∏–ª—å–º "${title}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!</span>`;
                    titleInput.value = '';
                    selectedAttributes.clear();
                    renderAttributesGrid();
                    updateStats();
                    
                    // –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
                    setTimeout(() => {
                        statusDiv.innerHTML = '';
                    }, 3000);
                } else {
                    statusDiv.innerHTML = '<span style="color: var(--danger);">–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∏–ª—å–º–∞!</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<span style="color: var(--danger);">–û—à–∏–±–∫–∞: ' + error.message + '</span>';
            }
        }

        function updateStats() {
            document.getElementById('filmsCount').textContent = akinator.database.length;
            document.getElementById('attributesCount').textContent = akinator.attributes.size;
        }

        async function displayFilmsList() {
            await waitForDatabase();
            
            const list = document.getElementById('filmsList');
            const loading = document.getElementById('loadingFilms');
            
            if (akinator.database.length === 0) {
                loading.innerHTML = '–ë–∞–∑–∞ —Ñ–∏–ª—å–º–æ–≤ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ñ–∏–ª—å–º!';
                return;
            }
            
            loading.style.display = 'none';
            list.style.display = 'block';
            list.innerHTML = '';
            
            akinator.database.forEach((film, index) => {
                const li = document.createElement('li');
                li.className = 'film-item';
                
                const filmInfo = document.createElement('div');
                filmInfo.innerHTML = `
                    <strong>${film.title}</strong>
                    <br><small>–ê—Ç—Ä–∏–±—É—Ç–æ–≤: ${Object.keys(film.attributes).length}</small>
                `;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                deleteBtn.style.marginLeft = '10px';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    if (confirm(`–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å–º "${film.title}"?`)) {
                        akinator.deleteFilm(index);
                        displayFilmsList();
                    }
                };
                
                li.appendChild(filmInfo);
                li.appendChild(deleteBtn);
                list.appendChild(li);
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è...');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            document.getElementById('loadingAttributes').style.display = 'block';
            document.getElementById('attributesGrid').style.display = 'none';
            document.getElementById('loadingFilms').style.display = 'block';
            document.getElementById('filmsList').style.display = 'none';
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã
            await waitForDatabase();
            
            console.log('–ë–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å');
            updateStats();
            renderAttributesGrid();
            displayFilmsList();
            
            // –°–∫—Ä—ã–≤–∞–µ–º loading —Å–æ—Å—Ç–æ—è–Ω–∏—è
            document.getElementById('loadingAttributes').style.display = 'none';
            document.getElementById('attributesGrid').style.display = 'grid';
        });
    </script>
</body>
</html>
